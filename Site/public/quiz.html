<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Palmeiras | Quiz</title>
    <link rel="icon" href="Imagens/Palmeiras Logo.webp">
    <link rel="stylesheet" href="quiz.css">
</head>


<body onload="onloadEsconder()">

    <link rel="stylesheet" href="quiz.css">


    <div class="navebar">
        <div class="savoia">
            <img src="Imagens/Savoia Palmeiras.png" alt="Mascote palmeiras">
        </div>
        <div class="botoes1">
            <i><a href="historia.html">HISTÓRIA</a></i>
            <i><a href="torcida.html">TORCIDA</a></i>
            <i><a href="quiz.html">QUIZ</a></i>

        </div>
        <div class="logo">
            <a href="index.html"><img src="Imagens/Palmeiras Logo.webp" alt="Logo do Palmeiras"></a>
        </div>
        <div class="botoes2">
            <i><a href="titulos.html">TÍTULOS</a></i>
            <i><a href="estadio.html">ESTÁDIO</a></i>
            <i><a href="sobremim.html">SOBRE MIM</a></i>

        </div>

    </div>


    <div class="navebar2"></div>


    <div class="fundo">
        <div class="pontuacaoEJogo">
            <div class="barra_titulo">
                <i>QUIZ DA GALERA, AVANTI PALESTRA!</i>
            </div>
            <div class="botao">
                <img src="Imagens/quiz.jpg" alt="" id="imagem">
                <button id="btnIniciarQuiz" onclick="iniciarQuiz()"><i>PLAY NO QUIZ</i></button>
            </div>

            <div id="pontuacao" class="placar">
                <div id="pontuacaoDuranteJogo" class="flex-colunar padding-8">
                    <span class="width-fit-content">Seus Acertos: <span id="spanCertas"></span></span>
                    <span class="width-fit-content">Seus Erros: <span id="spanErradas"></span></span>
                </div>
                <div id="pontuacaoFinalJogo" class="flex-colunar padding-8">
                    <span id="pontuacaoFinal" class="width-fit-content">Pontuação Final:
                        <span id="spanPontuacaoFinal">???</span>
                    </span>
                    <span id="msgFinal" class="width-fit-content"></span>
                </div>
            </div>

            <div id="jogo" class="width-fit-content flex-colunar border-secondary">

                <div id="infoQuestao" class="padding-8">
                    <span>Questão <span id="spanNumeroDaQuestaoAtual"></span> de <span id="qtdQuestoes"></span>
                        questões.</span>
                </div>

                <div id="perguntaDaQuestaoAtual" class="padding-8">
                    <span id="spanQuestaoExibida" class="text-bold"></span>
                </div>

                <div id="infoAlternativas" class="padding-8">
                    <span><em>Escolha uma opção entre as alternativas abaixo:</em></span>
                </div>

                <div id="opcoes" class="flex-colunar padding-8">
                    <span>
                        <input type="radio" id="primeiraOpcao" name="option" class="radio" value="alternativaA" />
                        <label for="primeiraOpcao" class="option" id="labelOpcaoUm"></label>
                    </span>
                    <span>
                        <input type="radio" id="segundaOpcao" name="option" class="radio" value="alternativaB" />
                        <label for="segundaOpcao" class="option" id="labelOpcaoDois"></label>
                    </span>
                    <span>
                        <input type="radio" id="terceiraOpcao" name="option" class="radio" value="alternativaC" />
                        <label for="terceiraOpcao" class="option" id="labelOpcaoTres"></label>
                    </span>
                    <span>
                        <input type="radio" id="quartaOpcao" name="option" class="radio" value="alternativaD" />
                        <label for="quartaOpcao" class="option" id="labelOpcaoQuatro"></label>
                    </span>
                </div>

                <div id="botoes" class="flex-colunar padding-8">
                    <div class="botoeiras">
                        <button onclick="submeter()" id="btnSubmeter">Confirmar</button>
                        <button onclick="avancar()" id="btnProx" disabled>Próximo</button>
                        <button onclick="tentarNovamente()" id="btnTentarNovamente" disabled>Tentar novamente</button>
                        <button id="desempenho"><a href="dashboard.html">Desempenho</a></button>
                    </div>
                </div>

            </div>
        </div>
    </div>


    <div class="footer">
        <div class="texto_footer">
            <i><a href="https://github.com/enricoantonucci">Github: enricoantonucci</a></i>
            <i><a href="">Linkedln: Enrico Assef</a></i>
            <i><a href="">Email: enrico.ferreira@sptech.school</a></i>
        </div>
    </div>

</body>

</html>
<script>
    // Verifica login
    if (!sessionStorage.ID_USUARIO) {
        window.location.href = "login.html";
    }

    const listaDeQuestoes = [
        {
            pergunta: "Qual foi o nome original do clube, fundado em 1914 por membros da colônia italiana em São Paulo?",
            alternativaA: "Associazione Sportiva Itália",
            alternativaB: "Palestra Mineiro",
            alternativaC: "Società Sportiva Palestra Italia",
            alternativaD: "Circolo Esportivo Itália",
            alternativaCorreta: "alternativaC"
        },
        {
            pergunta: "Qual é o nome do estádio atual do Palmeiras, inaugurado em 2014 no local do antigo Palestra Itália?",
            alternativaA: "Arena Palmeiras",
            alternativaB: "Arena Palestra",
            alternativaC: "Morumbi",
            alternativaD: "Allianz Parque",
            alternativaCorreta: "alternativaD"
        },
        {
            pergunta: "Qual jogador foi o goleiro ídolo do Palmeiras, conhecido pela frase 'Aqui é Palmeiras!' dita em uma disputa de pênaltis pela Libertadores de 2000?",
            alternativaA: "Leão",
            alternativaB: "Velloso",
            alternativaC: "Marcos",
            alternativaD: "Sérgio",
            alternativaCorreta: "alternativaC"
        },
        {
            pergunta: "Quantos títulos do Campeonato Brasileiro (a partir de 1971, incluindo Taça Brasil e Robertão, conforme unificação da CBF) o Palmeiras possui em sua história, até o final de 2024?",
            alternativaA: "10",
            alternativaB: "12",
            alternativaC: "11",
            alternativaD: "13",
            alternativaCorreta: "alternativaB"
        },
        {
            pergunta: "Qual é o jogador com mais partidas disputadas pelo Palmeiras em toda a história, com mais de 900 jogos?",
            alternativaA: "Dudu",
            alternativaB: "Marcos",
            alternativaC: "Emerson Leão",
            alternativaD: "Ademir da Guia",
            alternativaCorreta: "alternativaD"
        },
        {
            pergunta: "Em que ano o Palmeiras conquistou seu primeiro título da Copa Libertadores da América?",
            alternativaA: "1998",
            alternativaB: "1999",
            alternativaC: "2000",
            alternativaD: "2020",
            alternativaCorreta: "alternativaB"
        },
        {
            pergunta: "Quem foi o autor do gol de pênalti que garantiu o título da Copa Libertadores de 1999, na final contra o Deportivo Cali (COL)?",
            alternativaA: "Paulo Nunes",
            alternativaB: "Evair",
            alternativaC: "Alex",
            alternativaD: "Zinho",
            alternativaCorreta: "alternativaD"
        },
        {
            pergunta: "Em que ano o Società Sportiva Palestra Italia mudou oficialmente o seu nome para Sociedade Esportiva Palmeiras, durante o período da Segunda Guerra Mundial?",
            alternativaA: "1939",
            alternativaB: "1942",
            alternativaC: "1945",
            alternativaD: "1951",
            alternativaCorreta: "alternativaB"
        },
        {
            pergunta: "Antes da reconstrução e da adoção do nome Allianz Parque, qual era o nome popular do estádio do Palmeiras?",
            alternativaA: "Arena Pacaembu",
            alternativaB: "Estádio Parque Antártica",
            alternativaC: "Morada dos Deuses",
            alternativaD: "Estádio do Canindé",
            alternativaCorreta: "alternativaB"
        },
        {
            pergunta: "Qual jogador, que brilhou na 'Academia' (anos 60/70), é conhecido pela torcida como 'O Divino'?",
            alternativaA: "Ademir da Guia",
            alternativaB: "Luís Pereira",
            alternativaC: "Dudu",
            alternativaD: "Djalminha",
            alternativaCorreta: "alternativaA"
        },
        {
            pergunta: "Qual atacante do Palmeiras marcou dois gols no jogo de volta da final da Copa do Brasil de 2015, contra o Santos, levando a decisão para os pênaltis?",
            alternativaA: "Lucas Barrios",
            alternativaB: "Zé Roberto",
            alternativaC: "Gabriel Jesus",
            alternativaD: "Dudu",
            alternativaCorreta: "alternativaD"
        },
        {
            pergunta: "Quantos títulos de Copa do Brasil o Palmeiras já conquistou em sua história até o final de 2024?",
            alternativaA: "3",
            alternativaB: "4",
            alternativaC: "6",
            alternativaD: "5",
            alternativaCorreta: "alternativaB"
        },
        {
            pergunta: "Quantos títulos consecutivos de Campeonato Brasileiro o Palmeiras conquistou na sua história?",
            alternativaA: "1",
            alternativaB: "4",
            alternativaC: "3",
            alternativaD: "2",
            alternativaCorreta: "alternativaD"
        },
        {
            pergunta: "Quem é o maior artilheiro da história do Palmeiras, com 323 gols marcados entre 1916 e 1931?",
            alternativaA: "Evair",
            alternativaB: "Ademir da Guia",
            alternativaC: "César Maluco",
            alternativaD: "Heitor",
            alternativaCorreta: "alternativaD"
        },
        {
            pergunta: "Qual jogador do Palmeiras detém o recorde de mais gols marcados na história do 'Derby Paulista' (clássico contra o Corinthians)?",
            alternativaA: "César Maluco",
            alternativaB: "Servílio",
            alternativaC: "Luizinho",
            alternativaD: "Evair",
            alternativaCorreta: "alternativaA"
        },
        {
            pergunta: "Qual jogador fez o gol do Palmeiras na final da libertadores recebendo um passe do Mayke e levando o jogo para a prorrogação?",
            alternativaA: "Deyverson",
            alternativaB: "Raphael Veiga",
            alternativaC: "Gustavo Gomez",
            alternativaD: "Piquerez",
            alternativaCorreta: "alternativaB"
        },
        {
            pergunta: "Qual jogador era conhecido como Mago?",
            alternativaA: "Valdivia",
            alternativaB: "Cléber",
            alternativaC: "Cristaldo",
            alternativaD: "Robinho",
            alternativaCorreta: "alternativaA"
        },
        {
            pergunta: "Qual foi o adversário que o Palmeiras venceu na final, no Maracanã, para conquistar a Copa Rio de 1951, considerado o primeiro torneio mundial interclubes oficial da FIFA/CONMEBOL?",
            alternativaA: "Estrela Vermelha (Lugoslávia)",
            alternativaB: "Nacional (Uruguai)",
            alternativaC: "Sporting (Portugal)",
            alternativaD: "Juventus (Itália)",
            alternativaCorreta: "alternativaD"
        },
        {
            pergunta: "Quem foi o adversário do Palmeiras na final da Copa Libertadores de 2021, disputada em Montevidéu?",
            alternativaA: "Santos",
            alternativaB: "River Plate",
            alternativaC: "Atlético-MG",
            alternativaD: "Flamengo",
            alternativaCorreta: "alternativaD"
        },
        {
            pergunta: "Qual era o apelido dado ao Edmundo?",
            alternativaA: "Amostrado",
            alternativaB: "Cachorro",
            alternativaC: "Animal",
            alternativaD: "Pitbull cachorro louco",
            alternativaCorreta: "alternativaC"
        }
    ];

    let numeroDaQuestaoAtual = 0;
    let pontuacaoFinal = 0;
    let tentativaIncorreta = 0;
    let certas = 0;
    let erradas = 0;
    let quantidadeDeQuestoes = listaDeQuestoes.length;

    function onloadEsconder() {
        document.getElementById('pontuacao').style.display = "none";
        document.getElementById('jogo').style.display = "none";
        // Garante que o botão de desempenho comece oculto
        if(document.getElementById('desempenho')) {
            document.getElementById('desempenho').style.display = "none";
        }
    }

    function iniciarQuiz() {
        document.getElementById('pontuacao').style.display = "flex";
        document.getElementById('jogo').style.display = "flex";
        document.getElementById('imagem').style.display = "none";
        document.getElementById('btnIniciarQuiz').style.display = "none";
        document.getElementById('desempenho').style.display = "none"; // Garante que continua oculto

        document.getElementById('qtdQuestoes').innerHTML = quantidadeDeQuestoes;
        preencherHTMLcomQuestaoAtual(0);

        btnSubmeter.disabled = false;
        btnProx.disabled = true;
        btnTentarNovamente.disabled = true;
    }

    function preencherHTMLcomQuestaoAtual(index) {
        habilitarAlternativas(true);
        const questaoAtual = listaDeQuestoes[index];
        numeroDaQuestaoAtual = index;

        document.getElementById("spanNumeroDaQuestaoAtual").innerHTML = Number(index) + 1;
        document.getElementById("spanQuestaoExibida").innerHTML = questaoAtual.pergunta;
        document.getElementById("labelOpcaoUm").innerHTML = questaoAtual.alternativaA;
        document.getElementById("labelOpcaoDois").innerHTML = questaoAtual.alternativaB;
        document.getElementById("labelOpcaoTres").innerHTML = questaoAtual.alternativaC;
        document.getElementById("labelOpcaoQuatro").innerHTML = questaoAtual.alternativaD;
    }

    function submeter() {
        const options = document.getElementsByName("option");
        let hasChecked = false;
        for (let i = 0; i < options.length; i++) {
            if (options[i].checked) {
                hasChecked = true;
                break;
            }
        }
        if (!hasChecked) {
            alert("Não há alternativas escolhidas. Escolha uma opção.");
        } else {
            btnSubmeter.disabled = true;
            btnProx.disabled = false;
            habilitarAlternativas(false);
            checarResposta();
        }
    }

    function habilitarAlternativas(trueOrFalse) {
        let opcaoEscolhida = trueOrFalse ? false : true;
        primeiraOpcao.disabled = opcaoEscolhida;
        segundaOpcao.disabled = opcaoEscolhida;
        terceiraOpcao.disabled = opcaoEscolhida;
        quartaOpcao.disabled = opcaoEscolhida;
    }

    function avancar() {
        btnProx.disabled = true;
        btnSubmeter.disabled = false;
        desmarcarRadioButtons();

        if (numeroDaQuestaoAtual < quantidadeDeQuestoes - 1) {
            preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual);
        } else if (numeroDaQuestaoAtual == quantidadeDeQuestoes - 1) {
            alert("A próxima questão é a última, capricha!!");
            preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual);
        } else {
            finalizarJogo();
        }
        limparCoresBackgroundOpcoes();
    }

    function tentarNovamente() {
        window.location.reload();
    }

    function checarResposta() {
        const questaoAtual = listaDeQuestoes[numeroDaQuestaoAtual];
        const respostaQuestaoAtual = questaoAtual.alternativaCorreta;
        const options = document.getElementsByName("option");
        let alternativaCorreta = null;

        options.forEach((option) => {
            if (option.value === respostaQuestaoAtual) {
                alternativaCorreta = option.labels[0].id;
            }
        });

        options.forEach((option) => {
            if (option.checked === true && option.value === respostaQuestaoAtual) {
                document.getElementById(alternativaCorreta).classList.add("text-success-with-bg");
                pontuacaoFinal++;
                certas++;
                document.getElementById("spanCertas").innerHTML = certas;
                numeroDaQuestaoAtual++;
            } else if (option.checked && option.value !== respostaQuestaoAtual) {
                const wrongLabelId = option.labels[0].id;
                document.getElementById(wrongLabelId).classList.add("text-danger-with-bg");
                document.getElementById(alternativaCorreta).classList.add("text-success-with-bg");
                tentativaIncorreta++;
                erradas++;
                document.getElementById("spanErradas").innerHTML = erradas;
                numeroDaQuestaoAtual++;
            }
        });
    }

    function limparCoresBackgroundOpcoes() {
        const options = document.getElementsByName("option");
        options.forEach((option) => {
            document.getElementById(option.labels[0].id).classList.remove("text-danger-with-bg");
            document.getElementById(option.labels[0].id).classList.remove("text-success-with-bg");
        });
    }

    function desmarcarRadioButtons() {
        const options = document.getElementsByName("option");
        for (let i = 0; i < options.length; i++) {
            options[i].checked = false;
        }
    }

    function finalizarJogo() {
        let textoParaMensagemFinal = null;
        let classComCoresParaMensagemFinal = null;
        const porcentagemFinalDeAcertos = pontuacaoFinal / quantidadeDeQuestoes;

        if (porcentagemFinalDeAcertos <= 0.3) {
            textoParaMensagemFinal = "Vish, você não é Palmeirense sai daqui!";
            classComCoresParaMensagemFinal = "text-danger-with-bg";
        } else if (porcentagemFinalDeAcertos > 0.3 && porcentagemFinalDeAcertos < 0.76) {
            textoParaMensagemFinal = "Hummmm, parece que você é um infiltrado hein";
            classComCoresParaMensagemFinal = "text-warning-with-bg";
        } else if (porcentagemFinalDeAcertos >= 0.76) {
            textoParaMensagemFinal = "Avanti Palestra, você é um dos meus";
            classComCoresParaMensagemFinal = "text-success-with-bg";
        }

        textoParaMensagemFinal += "<br> Você acertou " + Math.round((porcentagemFinalDeAcertos) * 100) + "% das questões";

        document.getElementById('msgFinal').innerHTML = textoParaMensagemFinal;
        document.getElementById('msgFinal').classList.add(classComCoresParaMensagemFinal);
        document.getElementById('spanPontuacaoFinal').innerHTML = pontuacaoFinal;
        
        document.getElementById('jogo').classList.add("text-new-gray");

        btnProx.disabled = true;
        btnSubmeter.disabled = true;
        btnTentarNovamente.disabled = false;

        var idUsuario = sessionStorage.ID_USUARIO;

        if (idUsuario > 0) {
            
            desempenho(pontuacaoFinal, erradas, idUsuario);
        } else {
            console.log("Usuário não logado. Placar não será salvo.");
        }
    }

    function desempenho(pontuacao, erros, idUsuario) {
        
        document.getElementById('msgFinal').innerHTML += "<br><br><b>Salvando resultado... aguarde...</b>";

        fetch("/quiz/registrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                pontuacaoServer: pontuacao,
                errosServer: erros,
                idUsuarioServer: idUsuario
            })
        })
        .then(function (resposta) {
            console.log("Resposta da API:", resposta);

            if (resposta.ok) {
                
                alert("Veja seus resultados apertando no botão de desempenho");
                document.getElementById('desempenho').style.display = "flex";
                
            } else {
                alert("Erro ao salvar o resultado! Verifique o console do VS Code.");
                console.error("Erro ao salvar. Status:", resposta.status);
            }
        })
        .catch(function (erro) {
            console.log("Erro fetch:", erro);
            alert("Erro de conexão com a API.");
        });
    }
</script>